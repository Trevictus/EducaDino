import{a as D,b as C}from"./chunk-TGME2SXI.js";import{B as P,F as h,J as v,Mb as A,O as k,ea as w,h as d,i as g,l as a,u as s,x as c}from"./chunk-5N3JP377.js";import{a as u,b as p}from"./chunk-2NFLSA4Y.js";var x=class f{api=k(C);endpoint="/products";productsCache=w([]);products=this.productsCache.asReadonly();featuredProducts=A(()=>this.productsCache().filter(e=>e.featured));mockProducts=[{id:"prod-001",name:"Kit Excavaci\xF3n T-Rex",description:"Kit completo para excavaci\xF3n arqueol\xF3gica con r\xE9plica de f\xF3sil de T-Rex. Incluye herramientas y gu\xEDa educativa.",price:29.99,category:"Kits Educativos",image:"img/t-rex.png",stock:15,featured:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"prod-002",name:"Figura Velociraptor Articulada",description:"Figura articulada de Velociraptor a escala 1:6 con detalles realistas basados en descubrimientos recientes.",price:24.99,category:"Figuras",image:"img/velocirraptor.png",stock:25,featured:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"prod-003",name:"Puzzle 3D Triceratops",description:"Puzzle 3D de madera ecol\xF3gica con 150 piezas para armar tu propio Triceratops.",price:19.99,category:"Puzzles",image:"img/triceratops.png",stock:30,featured:!1,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"prod-004",name:"Libro: Era de los Dinosaurios",description:"Libro ilustrado con informaci\xF3n cient\xEDfica sobre los dinosaurios y su era. Perfecto para ni\xF1os de 8-12 a\xF1os.",price:15.99,category:"Libros",image:"img/quetzalcoatl.png",stock:50,featured:!0,createdAt:new Date("2024-04-20"),updatedAt:new Date("2024-04-20")},{id:"prod-005",name:"Peluche Argentinasaurio",description:"Peluche suave del Argentinasaurio, el dinosaurio m\xE1s grande descubierto en Argentina. 40cm de largo.",price:22.99,category:"Peluches",image:"img/argentinasaurus.png",stock:20,featured:!1,createdAt:new Date("2024-05-12"),updatedAt:new Date("2024-05-12")}];getProducts(){return this.useMockData()?d([...this.mockProducts]).pipe(c(300),a(e=>this.transformProducts(e)),h(e=>this.productsCache.set(e))):this.api.get(this.endpoint).pipe(P(2),a(e=>this.transformProducts(e)),h(e=>this.productsCache.set(e)),s(e=>this.handleError("getProducts",e)))}getFeaturedProducts(){if(this.useMockData()){let e=this.mockProducts.filter(t=>t.featured);return d(e).pipe(c(300),a(t=>this.transformProducts(t)))}return this.api.get(`${this.endpoint}/featured`).pipe(P(2),a(e=>this.transformProducts(e)),s(e=>this.handleError("getFeaturedProducts",e)))}getProductById(e){if(this.useMockData()){let t=this.mockProducts.find(r=>r.id===e);return t?d(u({},t)).pipe(c(300),a(r=>this.transformProduct(r))):g(()=>new Error(`Producto con ID "${e}" no encontrado`)).pipe(c(200))}return this.api.get(`${this.endpoint}/${e}`).pipe(P(2),a(t=>this.transformProduct(t)),s(t=>this.handleError("getProductById",t)))}search(e){if(this.useMockData())return this.mockSearch(e);let t=this.buildSearchParams(e);return this.api.get(`${this.endpoint}/search`,{params:t}).pipe(P(2),a(r=>p(u({},r),{data:this.transformProducts(r.data)})),s(r=>this.handleError("search",r)))}getProductsByCategory(e){if(this.useMockData()){let t=this.mockProducts.filter(r=>r.category.toLowerCase()===e.toLowerCase());return d(t).pipe(c(300),a(r=>this.transformProducts(r)))}return this.api.get(this.endpoint,{params:{category:e}}).pipe(P(2),a(t=>this.transformProducts(t)),s(t=>this.handleError("getProductsByCategory",t)))}createProduct(e){if(this.useMockData()){let t=p(u({},e),{id:`prod-${String(this.mockProducts.length+1).padStart(3,"0")}`,image:e.image||"img/t-rex.png",createdAt:new Date,updatedAt:new Date});return this.mockProducts.push(t),d(t).pipe(c(500))}return this.api.post(this.endpoint,e).pipe(h(t=>{this.productsCache.update(r=>[...r,t])}),s(t=>this.handleError("createProduct",t)))}updateProduct(e,t){if(this.useMockData()){let r=this.mockProducts.findIndex(i=>i.id===e);return r===-1?g(()=>new Error(`Producto con ID "${e}" no encontrado`)):(this.mockProducts[r]=p(u(u({},this.mockProducts[r]),t),{updatedAt:new Date}),d(this.mockProducts[r]).pipe(c(500)))}return this.api.put(`${this.endpoint}/${e}`,t).pipe(h(r=>{this.productsCache.update(i=>i.map(n=>n.id===e?r:n))}),s(r=>this.handleError("updateProduct",r)))}deleteProduct(e){if(this.useMockData()){let t=this.mockProducts.findIndex(r=>r.id===e);return t===-1?g(()=>new Error(`Producto con ID "${e}" no encontrado`)):(this.mockProducts.splice(t,1),d(!0).pipe(c(300)))}return this.api.delete(`${this.endpoint}/${e}`).pipe(a(()=>!0),h(()=>{this.productsCache.update(t=>t.filter(r=>r.id!==e))}),s(t=>this.handleError("deleteProduct",t)))}uploadImage(e,t){return this.useMockData()?d({success:!0,imageUrl:`img/${t.name}`,fileName:t.name}).pipe(c(1e3)):this.api.uploadFile(`${this.endpoint}/${e}/image`,t,"image").pipe(h(r=>{r.success&&this.productsCache.update(i=>i.map(n=>n.id===e?p(u({},n),{image:r.imageUrl}):n))}),s(r=>this.handleError("uploadImage",r)))}useMockData(){return!D.production||!D.apiUrl}transformProduct(e){return p(u({},e),{createdAt:e.createdAt?new Date(e.createdAt):void 0,updatedAt:e.updatedAt?new Date(e.updatedAt):void 0})}transformProducts(e){return e.map(t=>this.transformProduct(t))}buildSearchParams(e){let t={};return e.page!==void 0&&(t.page=e.page),e.pageSize!==void 0&&(t.pageSize=e.pageSize),e.search&&(t.search=e.search),e.category&&(t.category=e.category),e.minPrice!==void 0&&(t.minPrice=e.minPrice),e.maxPrice!==void 0&&(t.maxPrice=e.maxPrice),e.featured!==void 0&&(t.featured=e.featured),e.sortBy&&(t.sortBy=e.sortBy),e.sortOrder&&(t.sortOrder=e.sortOrder),t}mockSearch(e){let t=[...this.mockProducts];if(e.search){let o=e.search.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(o)||l.description.toLowerCase().includes(o))}e.category&&(t=t.filter(o=>o.category.toLowerCase()===e.category.toLowerCase())),e.minPrice!==void 0&&(t=t.filter(o=>o.price>=e.minPrice)),e.maxPrice!==void 0&&(t=t.filter(o=>o.price<=e.maxPrice)),e.featured!==void 0&&(t=t.filter(o=>o.featured===e.featured)),e.sortBy&&t.sort((o,l)=>{let m=o[e.sortBy],b=l[e.sortBy],y=e.sortOrder==="desc"?-1:1;return typeof m=="string"&&typeof b=="string"?m.localeCompare(b)*y:(m-b)*y});let r=e.page||1,i=e.pageSize||10,n=(r-1)*i,E={data:t.slice(n,n+i),meta:{currentPage:r,totalPages:Math.ceil(t.length/i),pageSize:i,totalItems:t.length,hasNextPage:r*i<t.length,hasPreviousPage:r>1}};return d(E).pipe(c(300),a(o=>p(u({},o),{data:this.transformProducts(o.data)})))}handleError(e,t){return console.error(`[ProductService.${e}] Error:`,t),g(()=>t)}static \u0275fac=function(t){return new(t||f)};static \u0275prov=v({token:f,factory:f.\u0275fac,providedIn:"root"})};export{x as a};
