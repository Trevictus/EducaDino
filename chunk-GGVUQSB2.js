import{b as E,c as A,e as R}from"./chunk-P5WGB6YT.js";import{B as f,Cb as C,F as g,J as v,O as y,ca as T,h as c,i as h,l as s,u as o,x as d}from"./chunk-DTMWPSUM.js";import{a as u,b as l}from"./chunk-2NFLSA4Y.js";var P={production:!1,apiUrl:"http://localhost:3000/api",appName:"EducaDino",appVersion:"1.0.0",enableLogging:!0,tokenKey:"auth_token",refreshTokenKey:"refresh_token",httpTimeout:3e4};var w=class p{http=y(R);baseUrl=P.apiUrl;get(e,t){return this.http.get(this.buildUrl(e),this.buildOptions(t)).pipe(o(this.handleError))}post(e,t,r){return this.http.post(this.buildUrl(e),t,this.buildOptions(r)).pipe(o(this.handleError))}put(e,t,r){return this.http.put(this.buildUrl(e),t,this.buildOptions(r)).pipe(o(this.handleError))}patch(e,t,r){return this.http.patch(this.buildUrl(e),t,this.buildOptions(r)).pipe(o(this.handleError))}delete(e,t){return this.http.delete(this.buildUrl(e),this.buildOptions(t)).pipe(o(this.handleError))}uploadFile(e,t,r="file",i){let a=new FormData;return a.append(r,t,t.name),i&&Object.entries(i).forEach(([m,D])=>{a.append(m,D)}),this.http.post(this.buildUrl(e),a,{}).pipe(o(this.handleError))}uploadMultipleFiles(e,t,r="files"){let i=new FormData;return t.forEach((a,m)=>{i.append(`${r}[${m}]`,a,a.name)}),this.http.post(this.buildUrl(e),i).pipe(o(this.handleError))}buildUrl(e){let t=e.startsWith("/")?e:`/${e}`;return`${this.baseUrl}${t}`}buildOptions(e){if(!e)return{};let t={};return e.params&&(t.params=this.buildParams(e.params)),e.headers&&(t.headers=e.headers instanceof E?e.headers:new E(e.headers)),e.context&&(t.context=e.context),e.reportProgress!==void 0&&(t.reportProgress=e.reportProgress),e.withCredentials!==void 0&&(t.withCredentials=e.withCredentials),t}buildParams(e){if(e instanceof A)return e;let t=new A;return Object.entries(e).forEach(([r,i])=>{i!=null&&(Array.isArray(i)?i.forEach(a=>{t=t.append(r,String(a))}):t=t.set(r,String(i)))}),t}handleError(e){return console.error("[ApiService] Error en petici\xF3n:",e),h(()=>e)}static \u0275fac=function(t){return new(t||p)};static \u0275prov=v({token:p,factory:p.\u0275fac,providedIn:"root"})};var S=class p{api=y(w);endpoint="/products";productsCache=T([],{});products=this.productsCache.asReadonly();featuredProducts=C(()=>this.productsCache().filter(e=>e.featured),{});mockProducts=[{id:"prod-001",name:"Kit Excavaci\xF3n T-Rex",description:"Kit completo para excavaci\xF3n arqueol\xF3gica con r\xE9plica de f\xF3sil de T-Rex. Incluye herramientas y gu\xEDa educativa.",price:29.99,category:"Kits Educativos",image:"img/t-rex.png",stock:15,featured:!0,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"prod-002",name:"Figura Velociraptor Articulada",description:"Figura articulada de Velociraptor a escala 1:6 con detalles realistas basados en descubrimientos recientes.",price:24.99,category:"Figuras",image:"img/velocirraptor.png",stock:25,featured:!0,createdAt:new Date("2024-02-10"),updatedAt:new Date("2024-02-10")},{id:"prod-003",name:"Puzzle 3D Triceratops",description:"Puzzle 3D de madera ecol\xF3gica con 150 piezas para armar tu propio Triceratops.",price:19.99,category:"Puzzles",image:"img/triceratops.png",stock:30,featured:!1,createdAt:new Date("2024-03-05"),updatedAt:new Date("2024-03-05")},{id:"prod-004",name:"Libro: Era de los Dinosaurios",description:"Libro ilustrado con informaci\xF3n cient\xEDfica sobre los dinosaurios y su era. Perfecto para ni\xF1os de 8-12 a\xF1os.",price:15.99,category:"Libros",image:"img/quetzalcoatl.png",stock:50,featured:!0,createdAt:new Date("2024-04-20"),updatedAt:new Date("2024-04-20")},{id:"prod-005",name:"Peluche Argentinasaurio",description:"Peluche suave del Argentinasaurio, el dinosaurio m\xE1s grande descubierto en Argentina. 40cm de largo.",price:22.99,category:"Peluches",image:"img/argentinasaurus.png",stock:20,featured:!1,createdAt:new Date("2024-05-12"),updatedAt:new Date("2024-05-12")}];getProducts(){return this.useMockData()?c([...this.mockProducts]).pipe(d(300),s(e=>this.transformProducts(e)),g(e=>this.productsCache.set(e))):this.api.get(this.endpoint).pipe(f(2),s(e=>this.transformProducts(e)),g(e=>this.productsCache.set(e)),o(e=>this.handleError("getProducts",e)))}getFeaturedProducts(){if(this.useMockData()){let e=this.mockProducts.filter(t=>t.featured);return c(e).pipe(d(300),s(t=>this.transformProducts(t)))}return this.api.get(`${this.endpoint}/featured`).pipe(f(2),s(e=>this.transformProducts(e)),o(e=>this.handleError("getFeaturedProducts",e)))}getProductById(e){if(this.useMockData()){let t=this.mockProducts.find(r=>r.id===e);return t?c(u({},t)).pipe(d(300),s(r=>this.transformProduct(r))):h(()=>new Error(`Producto con ID "${e}" no encontrado`)).pipe(d(200))}return this.api.get(`${this.endpoint}/${e}`).pipe(f(2),s(t=>this.transformProduct(t)),o(t=>this.handleError("getProductById",t)))}search(e){if(this.useMockData())return this.mockSearch(e);let t=this.buildSearchParams(e);return this.api.get(`${this.endpoint}/search`,{params:t}).pipe(f(2),s(r=>l(u({},r),{data:this.transformProducts(r.data)})),o(r=>this.handleError("search",r)))}getProductsByCategory(e){if(this.useMockData()){let t=this.mockProducts.filter(r=>r.category.toLowerCase()===e.toLowerCase());return c(t).pipe(d(300),s(r=>this.transformProducts(r)))}return this.api.get(this.endpoint,{params:{category:e}}).pipe(f(2),s(t=>this.transformProducts(t)),o(t=>this.handleError("getProductsByCategory",t)))}createProduct(e){if(this.useMockData()){let t=l(u({},e),{id:`prod-${String(this.mockProducts.length+1).padStart(3,"0")}`,image:e.image||"img/t-rex.png",createdAt:new Date,updatedAt:new Date});return this.mockProducts.push(t),c(t).pipe(d(500))}return this.api.post(this.endpoint,e).pipe(g(t=>{this.productsCache.update(r=>[...r,t])}),o(t=>this.handleError("createProduct",t)))}updateProduct(e,t){if(this.useMockData()){let r=this.mockProducts.findIndex(i=>i.id===e);return r===-1?h(()=>new Error(`Producto con ID "${e}" no encontrado`)):(this.mockProducts[r]=l(u(u({},this.mockProducts[r]),t),{updatedAt:new Date}),c(this.mockProducts[r]).pipe(d(500)))}return this.api.put(`${this.endpoint}/${e}`,t).pipe(g(r=>{this.productsCache.update(i=>i.map(a=>a.id===e?r:a))}),o(r=>this.handleError("updateProduct",r)))}deleteProduct(e){if(this.useMockData()){let t=this.mockProducts.findIndex(r=>r.id===e);return t===-1?h(()=>new Error(`Producto con ID "${e}" no encontrado`)):(this.mockProducts.splice(t,1),c(!0).pipe(d(300)))}return this.api.delete(`${this.endpoint}/${e}`).pipe(s(()=>!0),g(()=>{this.productsCache.update(t=>t.filter(r=>r.id!==e))}),o(t=>this.handleError("deleteProduct",t)))}uploadImage(e,t){return this.useMockData()?c({success:!0,imageUrl:`img/${t.name}`,fileName:t.name}).pipe(d(1e3)):this.api.uploadFile(`${this.endpoint}/${e}/image`,t,"image").pipe(g(r=>{r.success&&this.productsCache.update(i=>i.map(a=>a.id===e?l(u({},a),{image:r.imageUrl}):a))}),o(r=>this.handleError("uploadImage",r)))}useMockData(){return!P.production||!P.apiUrl}transformProduct(e){return l(u({},e),{createdAt:e.createdAt?new Date(e.createdAt):void 0,updatedAt:e.updatedAt?new Date(e.updatedAt):void 0})}transformProducts(e){return e.map(t=>this.transformProduct(t))}buildSearchParams(e){let t={};return e.page!==void 0&&(t.page=e.page),e.pageSize!==void 0&&(t.pageSize=e.pageSize),e.search&&(t.search=e.search),e.category&&(t.category=e.category),e.minPrice!==void 0&&(t.minPrice=e.minPrice),e.maxPrice!==void 0&&(t.maxPrice=e.maxPrice),e.featured!==void 0&&(t.featured=e.featured),e.sortBy&&(t.sortBy=e.sortBy),e.sortOrder&&(t.sortOrder=e.sortOrder),t}mockSearch(e){let t=[...this.mockProducts];if(e.search){let n=e.search.toLowerCase();t=t.filter(b=>b.name.toLowerCase().includes(n)||b.description.toLowerCase().includes(n))}e.category&&(t=t.filter(n=>n.category.toLowerCase()===e.category.toLowerCase())),e.minPrice!==void 0&&(t=t.filter(n=>n.price>=e.minPrice)),e.maxPrice!==void 0&&(t=t.filter(n=>n.price<=e.maxPrice)),e.featured!==void 0&&(t=t.filter(n=>n.featured===e.featured)),e.sortBy&&t.sort((n,b)=>{let k=n[e.sortBy],O=b[e.sortBy],x=e.sortOrder==="desc"?-1:1;return typeof k=="string"&&typeof O=="string"?k.localeCompare(O)*x:(k-O)*x});let r=e.page||1,i=e.pageSize||10,a=(r-1)*i,D={data:t.slice(a,a+i),meta:{currentPage:r,totalPages:Math.ceil(t.length/i),pageSize:i,totalItems:t.length,hasNextPage:r*i<t.length,hasPreviousPage:r>1}};return c(D).pipe(d(300),s(n=>l(u({},n),{data:this.transformProducts(n.data)})))}handleError(e,t){return console.error(`[ProductService.${e}] Error:`,t),h(()=>t)}static \u0275fac=function(t){return new(t||p)};static \u0275prov=v({token:p,factory:p.\u0275fac,providedIn:"root"})};export{P as a,S as b};
